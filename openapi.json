{
  "openapi": "3.1.0",
  "info": {
    "title": "Observation Tools API",
    "description": "API for the Observation Tools developer data inspection toolkit",
    "license": {
      "name": "AGPL-3",
      "identifier": "AGPL-3"
    },
    "version": "0.1.0"
  },
  "paths": {
    "/api/exe": {
      "get": {
        "tags": ["executions"],
        "summary": "List all executions",
        "operationId": "list_executions",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results to return",
            "required": false,
            "schema": {
              "type": ["integer", "null"],
              "minimum": 0
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip (for pagination)",
            "required": false,
            "schema": {
              "type": ["integer", "null"],
              "minimum": 0
            }
          },
          {
            "name": "search",
            "in": "query",
            "description": "Search query for execution names or metadata",
            "required": false,
            "schema": {
              "type": ["string", "null"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of executions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListExecutionsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          }
        }
      },
      "post": {
        "tags": ["executions"],
        "summary": "Create a new execution",
        "operationId": "create_execution",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateExecutionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Execution created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateExecutionResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          }
        }
      }
    },
    "/api/exe/{execution_id}/obs": {
      "get": {
        "tags": ["observations"],
        "summary": "List observations for an execution",
        "operationId": "list_observations",
        "parameters": [
          {
            "name": "execution_id",
            "in": "path",
            "description": "Execution ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results to return",
            "required": false,
            "schema": {
              "type": ["integer", "null"],
              "minimum": 0
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip (for pagination)",
            "required": false,
            "schema": {
              "type": ["integer", "null"],
              "minimum": 0
            }
          },
          {
            "name": "search",
            "in": "query",
            "description": "Search query for observation names or metadata",
            "required": false,
            "schema": {
              "type": ["string", "null"]
            }
          },
          {
            "name": "labels",
            "in": "query",
            "description": "Filter by labels (comma-separated)",
            "required": false,
            "schema": {
              "type": ["string", "null"]
            }
          },
          {
            "name": "source_file",
            "in": "query",
            "description": "Filter by source file",
            "required": false,
            "schema": {
              "type": ["string", "null"]
            }
          },
          {
            "name": "parent_span_id",
            "in": "query",
            "description": "Filter by parent span ID",
            "required": false,
            "schema": {
              "type": ["string", "null"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of observations",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListObservationsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          }
        }
      },
      "post": {
        "tags": ["observations"],
        "summary": "Create observations (batch)",
        "operationId": "create_observations",
        "parameters": [
          {
            "name": "execution_id",
            "in": "path",
            "description": "Execution ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateObservationsRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Observations created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateObservationsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          }
        }
      }
    },
    "/api/exe/{execution_id}/obs/{observation_id}": {
      "get": {
        "tags": ["observations"],
        "summary": "Get a single observation",
        "operationId": "get_observation",
        "parameters": [
          {
            "name": "execution_id",
            "in": "path",
            "description": "Execution ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "observation_id",
            "in": "path",
            "description": "Observation ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Observation details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetObservationResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Observation not found"
          }
        }
      }
    },
    "/api/exe/{execution_id}/obs/{observation_id}/content": {
      "get": {
        "tags": ["observations"],
        "summary": "Get observation blob content",
        "operationId": "get_observation_blob",
        "parameters": [
          {
            "name": "execution_id",
            "in": "path",
            "description": "Execution ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "observation_id",
            "in": "path",
            "description": "Observation ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Observation blob content",
            "content": {
              "application/octet-stream": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "integer",
                    "format": "int32",
                    "minimum": 0
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Observation blob not found"
          }
        }
      }
    },
    "/api/exe/{id}": {
      "get": {
        "tags": ["executions"],
        "summary": "Get a single execution",
        "operationId": "get_execution",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Execution ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Execution details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetExecutionResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Execution not found"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "CreateExecutionRequest": {
        "type": "object",
        "description": "Request to create a new execution",
        "required": ["execution"],
        "properties": {
          "execution": {
            "$ref": "#/components/schemas/Execution",
            "description": "The execution to create"
          }
        }
      },
      "CreateExecutionResponse": {
        "type": "object",
        "description": "Response after creating an execution"
      },
      "CreateObservationsRequest": {
        "type": "object",
        "description": "Request to create observations (can be a batch)",
        "required": ["observations"],
        "properties": {
          "observations": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Observation"
            },
            "description": "List of observations to create"
          }
        }
      },
      "CreateObservationsResponse": {
        "type": "object",
        "description": "Response after creating observations"
      },
      "ErrorResponse": {
        "type": "object",
        "description": "API error response",
        "required": ["error"],
        "properties": {
          "code": {
            "type": ["string", "null"],
            "description": "Optional error code"
          },
          "details": {
            "description": "Optional additional details"
          },
          "error": {
            "type": "string",
            "description": "Error message"
          }
        }
      },
      "Execution": {
        "type": "object",
        "description": "An execution represents the root scope for data collection.\nAll observations are associated with one execution.",
        "required": ["id", "name", "created_at", "updated_at"],
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When this execution was created"
          },
          "id": {
            "$ref": "#/components/schemas/ExecutionId",
            "description": "Unique identifier for this execution"
          },
          "metadata": {
            "type": "object",
            "description": "User-defined metadata as key-value pairs",
            "additionalProperties": {
              "type": "string"
            },
            "propertyNames": {
              "type": "string"
            }
          },
          "name": {
            "type": "string",
            "description": "User-defined name for this execution"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "When this execution was last updated"
          }
        }
      },
      "ExecutionId": {
        "type": "string",
        "description": "Unique identifier for an execution (UUIDv7)",
        "example": "018e9a3a2c1b7e3f8d2a4b5c6d7e8f9a"
      },
      "GetExecutionResponse": {
        "type": "object",
        "description": "Response for getting a single execution",
        "required": ["execution"],
        "properties": {
          "execution": {
            "$ref": "#/components/schemas/Execution",
            "description": "The execution"
          }
        }
      },
      "GetObservationResponse": {
        "type": "object",
        "description": "Response for getting a single observation",
        "required": ["observation"],
        "properties": {
          "observation": {
            "$ref": "#/components/schemas/Observation",
            "description": "The observation"
          }
        }
      },
      "ListExecutionsQuery": {
        "type": "object",
        "description": "Query parameters for listing executions",
        "properties": {
          "limit": {
            "type": ["integer", "null"],
            "description": "Maximum number of results to return",
            "minimum": 0
          },
          "offset": {
            "type": ["integer", "null"],
            "description": "Number of results to skip (for pagination)",
            "minimum": 0
          },
          "search": {
            "type": ["string", "null"],
            "description": "Search query for execution names or metadata"
          }
        }
      },
      "ListExecutionsResponse": {
        "type": "object",
        "description": "Response for listing executions",
        "required": ["executions", "has_next_page"],
        "properties": {
          "executions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Execution"
            },
            "description": "List of executions"
          },
          "has_next_page": {
            "type": "boolean",
            "description": "Whether there are more results available"
          }
        }
      },
      "ListObservationsQuery": {
        "type": "object",
        "description": "Query parameters for listing observations",
        "properties": {
          "labels": {
            "type": ["string", "null"],
            "description": "Filter by labels (comma-separated)"
          },
          "limit": {
            "type": ["integer", "null"],
            "description": "Maximum number of results to return",
            "minimum": 0
          },
          "offset": {
            "type": ["integer", "null"],
            "description": "Number of results to skip (for pagination)",
            "minimum": 0
          },
          "parent_span_id": {
            "type": ["string", "null"],
            "description": "Filter by parent span ID"
          },
          "search": {
            "type": ["string", "null"],
            "description": "Search query for observation names or metadata"
          },
          "source_file": {
            "type": ["string", "null"],
            "description": "Filter by source file"
          }
        }
      },
      "ListObservationsResponse": {
        "type": "object",
        "description": "Response for listing observations",
        "required": ["observations", "has_next_page"],
        "properties": {
          "has_next_page": {
            "type": "boolean",
            "description": "Whether there are more results available"
          },
          "observations": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Observation"
            },
            "description": "List of observations"
          }
        }
      },
      "Observation": {
        "type": "object",
        "description": "An observation is a single piece of collected data",
        "required": ["id", "execution_id", "name", "payload", "created_at"],
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When this observation was created"
          },
          "execution_id": {
            "$ref": "#/components/schemas/ExecutionId",
            "description": "ID of the execution this observation belongs to"
          },
          "id": {
            "$ref": "#/components/schemas/ObservationId",
            "description": "Unique identifier for this observation"
          },
          "labels": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Hierarchical labels for grouping observations\nUses path convention (e.g., \"api/request/headers\")"
          },
          "metadata": {
            "type": "object",
            "description": "User-defined metadata as key-value pairs",
            "additionalProperties": {
              "type": "string"
            },
            "propertyNames": {
              "type": "string"
            }
          },
          "name": {
            "type": "string",
            "description": "User-defined name for this observation"
          },
          "parent_span_id": {
            "type": ["string", "null"],
            "description": "Parent span ID (for tracing integration)"
          },
          "payload": {
            "$ref": "#/components/schemas/Payload",
            "description": "The observation payload"
          },
          "source": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/SourceInfo",
                "description": "Source location where this observation was created"
              }
            ]
          }
        }
      },
      "ObservationId": {
        "type": "string",
        "description": "Unique identifier for an observation (UUIDv7)",
        "example": "018e9a3a2c1b7e3f8d2a4b5c6d7e8f9b"
      },
      "Payload": {
        "type": "object",
        "description": "Payload data for an observation",
        "required": ["data", "mime_type", "size"],
        "properties": {
          "data": {
            "type": "string",
            "description": "The actual payload data"
          },
          "mime_type": {
            "type": "string",
            "description": "MIME type of the payload (e.g., \"text/plain\", \"application/json\")"
          },
          "size": {
            "type": "integer",
            "description": "Size of the payload in bytes",
            "minimum": 0
          }
        }
      },
      "SourceInfo": {
        "type": "object",
        "description": "Source location information for an observation",
        "required": ["file", "line"],
        "properties": {
          "column": {
            "type": ["integer", "null"],
            "format": "int32",
            "description": "Optional column number",
            "minimum": 0
          },
          "file": {
            "type": "string",
            "description": "Source file path"
          },
          "line": {
            "type": "integer",
            "format": "int32",
            "description": "Line number in the source file",
            "minimum": 0
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "executions",
      "description": "Execution management endpoints"
    },
    {
      "name": "observations",
      "description": "Observation management endpoints"
    }
  ]
}
