<div style="display: flex; flex-direction: column; height: 100%;">
  <div style="flex-shrink: 0;">
    <h1>{{ observation.name }}</h1>

    <p><span class="meta">id:</span> <code data-testid="ObservationId">{{ observation.id }}</code></p>
    <p><span class="meta">created:</span> {{ observation.created_at }}</p>

    {% if observation.source %}
    <p>
      <span class="meta">source:</span>
      <code
        ><span data-testid="ObservationSourceFile">{{ observation.source.file }}</span>:<span
          data-testid="ObservationSourceLine"
          >{{ observation.source.line }}</span
        ></code
      >
    </p>
    {% endif %} {% if observation.parent_span_id %}
    <p><span class="meta">parent span:</span> <code>{{ observation.parent_span_id }}</code></p>
    {% endif %} {% if observation.labels %}
    <p data-testid="ObservationLabels">
      <span class="meta">labels:</span> {{ observation.labels|join(", ") }}
    </p>
    {% endif %} {% if observation.metadata %}
    <h3>metadata</h3>
    <ul>
      {% for key, value in observation.metadata %}
      <li>{{ key }}: {{ value }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <hr />

    <h2>payload</h2>
    <p><span class="meta">type:</span> {{ observation.payload.mime_type }}</p>
    <p><span class="meta">size:</span> {{ observation.payload.size }} bytes</p>
    <p>
      <a
        href="/api/exe/{{ observation.execution_id }}/obs/{{ observation.id }}/content"
        target="_blank"
        rel="noopener noreferrer"
      >Open raw content in new tab</a>
    </p>
  </div>

  {% if observation.payload.size > display_threshold %}
  <div style="flex-grow: 1;">
    <p data-testid="ObservationPayload">Payload is too large to display inline.</p>
  </div>
  {% else %}
  <iframe
    id="observation-iframe"
    data-testid="ObservationPayload"
    src="/api/exe/{{ observation.execution_id }}/obs/{{ observation.id }}/content"
    style="width: 100%; border: 1px solid #ccc; flex-grow: 1; min-height: 0;"
    sandbox="allow-same-origin"
  ></iframe>
  {% endif %}
</div>
