{% extends "base.html" %} {% block title %}{{ execution.name }}{% endblock %} {% block content %}

<div class="panel-container {% if selected_observation %}with-sidebar{% endif %}">
  <div class="main-content">
    <p class="meta"><a href="/">home</a> / <a href="/exe">executions</a> / {{ execution.name }}</p>

    <h1 data-testid="ExecutionDetailTitle">{{ execution.name }}</h1>

    <p>
      <span class="meta">id:</span> <code data-testid="ExecutionDetailId">{{ execution.id }}</code>
    </p>
    <p><span class="meta">created:</span> {{ execution.created_at }}</p>

    {% if execution.metadata %}
    <h3>metadata</h3>
    <ul>
      {% for key, value in execution.metadata %}
      <li>{{ key }}: {{ value }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <hr />

    <h2>observations</h2>

    <div id="observations-list">
      {% if observations %}
      <ul>
        {% for obs in observations %}
        <li data-testid="ObservationListItem">
          <a
            data-testid="ObservationListItemLink"
            href="/exe/{{ execution.id }}?obs={{ obs.id }}"
            class="observation-link {% if selected_observation and selected_observation.id == obs.id %}active{% endif %}"
            >{{ obs.name }}</a
          >
          <span class="meta">
            — {{ obs.payload.mime_type }} {% if obs.source %}— {{ obs.source.file }}:{{
            obs.source.line }}{% endif %} — {{ obs.created_at }}
          </span>
          {% if obs.labels %}
          <br /><span class="meta">labels: {{ obs.labels|join(", ") }}</span>
          {% endif %}
        </li>
        {% endfor %}
      </ul>

      {% if total_count %}
      <div class="pagination">
        <p data-testid="PaginationInfo">
          <span class="meta">
            showing {{ offset + 1 }}-{{ offset + observations|length }} of {{ total_count }} (page
            {{ page }})
          </span>
        </p>
        <div>
          {% if offset > 0 %}
          <button
            data-testid="PaginationPrev"
            onclick="window.location.href='/exe/{{ execution.id }}?offset={{ offset - limit }}&limit={{ limit }}'"
          >
            ← prev
          </button>
          {% else %}
          <button data-testid="PaginationPrev" disabled>← prev</button>
          {% endif %} {% if has_next_page %}
          <button
            data-testid="PaginationNext"
            onclick="window.location.href='/exe/{{ execution.id }}?offset={{ offset + limit }}&limit={{ limit }}'"
          >
            next →
          </button>
          {% else %}
          <button data-testid="PaginationNext" disabled>next →</button>
          {% endif %}
        </div>
      </div>
      {% endif %} {% else %}
      <p>no observations found.</p>
      {% endif %}
    </div>
  </div>

  {% if selected_observation %}
  <div class="side-panel active" id="side-panel">
    <div style="flex-shrink: 0;">
      <a href="/exe/{{ execution.id }}" class="side-panel-close">×</a>
    </div>
    <div id="side-panel-content" style="flex-grow: 1; min-height: 0; display: flex; flex-direction: column;">
      {% set observation = selected_observation %} {% include "_observation_content.html" %}
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
